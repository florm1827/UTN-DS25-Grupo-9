generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL") // pooler 6543 (runtime)
  directUrl = env("DIRECT_URL") // directa 5432 (migraciones)
}

enum Rol {
  USUARIO
  ADMIN
}

enum EstadoCancha {
  HABILITADA
  DESHABILITADA
}

enum EstadoReserva {
  PENDIENTE
  ACEPTADA
  RECHAZADA
  CANCELADA
}

model Usuario {
  id              String    @id @default(uuid())
  nombre          String
  email           String    @unique
  rol             Rol       @default(USUARIO)
  contraseniaHash String
  creadoEn        DateTime  @default(now())
  actualizadoEn   DateTime  @updatedAt
  reservas        Reserva[]
}

model Cancha {
  id            String       @id @default(uuid())
  nombre        String       @unique
  estado        EstadoCancha @default(HABILITADA)
  creadoEn      DateTime     @default(now())
  actualizadoEn DateTime     @updatedAt
  reservas      Reserva[]
}

model Reserva {
  id            String        @id @default(uuid())
  usuarioId     String?
  usuario       Usuario?      @relation(fields: [usuarioId], references: [id])
  canchaId      String
  cancha        Cancha        @relation(fields: [canchaId], references: [id])
  inicio        DateTime
  fin           DateTime
  estado        EstadoReserva @default(PENDIENTE)
  nombreMostrar String
  creadoEn      DateTime      @default(now())
  actualizadoEn DateTime      @updatedAt
  motivoRechazo String?

  @@index([canchaId, inicio, fin, estado])
}

model Precio {
  id               Int      @id @default(1)
  minutosPorBloque Int      @default(30)
  precioPorBloque  Int
  moneda           String   @default("ARS")
  vigenteDesde     DateTime @default(now())
  actualizadoEn    DateTime @updatedAt
}
